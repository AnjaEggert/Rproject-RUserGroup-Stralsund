---
title: "Pig-context-hormones"
author: "Anja & Liza"
date: "`r Sys.Date()`"
output:
  html_document:
    code_folding: show
    toc: true
    toc_depth: 3
    toc_float: true
---

```{r setup, include=FALSE, message = FALSE, warning = FALSE, eval = FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)

# include = FALSE prevents code and results from appearing in the finished file, but code runs.
# echo = FALSE prevents code, but not the results from appearing in the finished file.
# message = FALSE prevents messages that are generated by code from appearing in the finished file.
# warning = FALSE prevents warnings that are generated by code from appearing in the finished.
```

```{r libraries}
library(knitr)
library(kableExtra)
library(tidyverse)
library(lubridate)   # to handle date and time
```

# Read data from master file

* Liza removed already 2 major cortisol outliers (both >> 5 SDs from the mean), better do it in the code

```{r}
dat.cort <- read_csv(file = "./data/prosocial-pigs-cortisol.csv")  
dat.oxyt <- read_csv(file = "./data/prosocial-pigs-oxytocin.csv")  
```

\ 

* mutate `sample`, `sow` and `group.order` from double to factor
* mutate `date` from character to date format
* mutate `context` from character to ordered factor

* create `uniq.group` from `dg` + `group`
* create `uniq.id` from `dg` + `group` + `sample`


```{r}
dat.cort <- dat.cort %>%
  mutate(sample      = factor(sample)) %>% 
  mutate(sow         = factor(sow)) %>%
  mutate(group.order = factor(group.order)) %>%
  mutate(date        = lubridate::dmy(date)) %>%
  mutate(context     = factor(context,
                              levels=c("Baseline","Weaning","Play","Separation","Reunion"))) %>% 
  mutate(uniq.group  = paste0(dg,"_", group)) %>%
  mutate(uniq.id     = paste0(dg,"_", group, "_", sample)) %>%
  rename(age         = lt) %>% 
  select(!c(dg, group, sample))
```

```{r}
dat.oxyt <- dat.oxyt %>%
  mutate(sample      = factor(sample)) %>% 
  mutate(sow         = factor(sow)) %>%
  mutate(group.order = factor(group.order)) %>%
  mutate(date        = lubridate::dmy(date)) %>%
  mutate(context     = factor(context,
                              levels=c("Baseline","Weaning","Play","Separation","Reunion"))) %>% 
  mutate(uniq.group  = paste0(dg,"_", group)) %>%
  mutate(uniq.id     = paste0(dg,"_", group, "_", sample)) %>%
  rename(age         = lt) %>% 
  rename(oxyt_pgml   = oxt_pgml) %>% 
  select(!c(dg, group, sample))
```

\ 

# Merge cort + oxyt tables

* When we combine the two datasets, we realize that there are some cortisol values without oxytocin values, and some oxytocin values without any cortisol values.
* This is because we did not always have enough saliva to run both samples.

```{r}
dat.horm <- full_join(dat.cort, dat.oxyt,
                      by = c("uniq.id", "date", "time", "context"),
                      suffix = c("", ".oxyt")) %>%
  mutate(sex = ifelse(is.na(sex), sex.oxyt, sex)) %>% 
  mutate(sow = ifelse(is.na(sow), sow.oxyt, sow)) %>% 
  mutate(group.order = ifelse(is.na(group.order), group.order.oxyt, group.order)) %>% 
  mutate(age = ifelse(is.na(age), age.oxyt, age)) %>% 
  mutate(testday = ifelse(is.na(testday), testday.oxyt, testday)) %>% 
  mutate(uniq.group = ifelse(is.na(uniq.group), uniq.group.oxyt, uniq.group)) %>%
  rename(plate.name.cort = plate.name) %>%
  dplyr::select(!ends_with(".oxyt"),plate.name.oxyt)
```

* create `time.n` as numeric decimal hours
* create z-transformed "scaled" `time.n.z` and `age.z`

```{r}
dat.horm <- dat.horm %>% 
  mutate(time.n      = lubridate::hour(time) + lubridate::minute(time)/60) %>% 
  mutate(time.n.z    = scale(time.n)) %>% 
  mutate(age.z       = scale(age))
```

* Number of observations:
  + cortisol samples: `r sum(!is.na(dat.horm$cort_ngml))`
  + oxytocin samples: `r sum(!is.na(dat.horm$oxyt_pgml))`
\ 

# Export merged table

```{r}
write.table(dat.horm , file = "./data/prosocial-pigs-hormones-master.csv", row.names = FALSE, sep =",")
```

\ 

# Session Info

```{r}
sessionInfo()
```




